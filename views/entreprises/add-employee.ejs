<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter un Salari√© - ADSIAM</title>
    <style>
        :root {
            /* Couleurs principales */
            --primary-pink: #e7a6b7;      /* Rose gold doux */
            --primary-blue: #a5bfd4;      /* Bleu poudr√© */
            
            /* Couleurs secondaires */
            --light-pink: #fce8ec;        /* Rose tr√®s clair */
            --light-blue: #e8f3f8;        /* Bleu tr√®s clair */
            --soft-gray: #f5f5f7;         /* Gris clair neutre */
            
            /* Texte */
            --text-dark: #2f2f2f;         /* Gris anthracite lisible */
            --text-light: #6f6f6f;        /* Gris doux */
            --white: #ffffff;

            /* D√©grad√©s */
            --gradient-pink: linear-gradient(135deg, #fce8ec, #e7a6b7);
            --gradient-blue: linear-gradient(135deg, #e8f3f8, #a5bfd4);
            --gradient-contact: linear-gradient(135deg, #e7a6b7, #a5bfd4);
            --gradient-purple: linear-gradient(135deg, #f0e1ff, #c7a3ff);
            --gradient-green: linear-gradient(135deg, #e2f8ee, #9dd6b5);
            --gradient-orange: linear-gradient(135deg, #ffe9dc, #ff9f80);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--soft-gray);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .header {
            background: var(--white);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .breadcrumb a {
            color: var(--primary-blue);
            text-decoration: none;
            transition: color 0.3s;
        }

        .breadcrumb a:hover {
            color: var(--primary-pink);
        }

        .form-container {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .form-section {
            margin-bottom: 2.5rem;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--soft-gray);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-icon {
            width: 35px;
            height: 35px;
            background: var(--gradient-contact);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-label.required::after {
            content: ' *';
            color: #e74c3c;
            font-weight: bold;
        }

        .form-input {
            padding: 0.875rem 1rem;
            border: 2px solid var(--soft-gray);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: var(--white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(165, 191, 212, 0.2);
        }

        .form-select {
            padding: 0.875rem 1rem;
            border: 2px solid var(--soft-gray);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--white);
            cursor: pointer;
            transition: all 0.3s;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(165, 191, 212, 0.2);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-help {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--soft-gray);
        }

        .btn {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--gradient-contact);
            color: white;
            box-shadow: 0 8px 25px rgba(231, 166, 183, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(231, 166, 183, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-light);
            border: 2px solid var(--soft-gray);
        }

        .btn-secondary:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .alert {
            padding: 1rem 1.25rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            display: none;
        }

        .alert.success {
            background: var(--gradient-green);
            color: white;
        }

        .alert.error {
            background: linear-gradient(135deg, #ffebee, #f44336);
            color: white;
        }

        .profile-preview {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--light-blue);
            border-radius: 10px;
            margin-top: 1rem;
        }

        .avatar-preview {
            width: 60px;
            height: 60px;
            background: var(--gradient-contact);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .preview-info h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .preview-info p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .container {
                padding: 0 0.5rem;
            }
            
            .form-container {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="/entreprise/dashboard">Tableau de bord</a>
            <span>‚Ä∫</span>
            <a href="/entreprise/salaries">Salari√©s</a>
            <span>‚Ä∫</span>
            <span>Ajouter un salari√©</span>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>Ajouter un nouveau salari√©</h1>
            <p>Ajoutez un membre de votre √©quipe pour qu'il puisse acc√©der aux formations ADSIAM</p>
        </div>

        <!-- Alerts -->
        <div id="successAlert" class="alert success">
            <strong>Succ√®s !</strong> Le salari√© a √©t√© ajout√© avec succ√®s.
        </div>
        
        <div id="errorAlert" class="alert error">
            <strong>Erreur !</strong> <span id="errorMessage">Une erreur est survenue.</span>
        </div>

        <!-- Form -->
        <div class="form-container">
            <form id="addEmployeeForm" novalidate>
                <!-- Informations personnelles -->
                <div class="form-section">
                    <h3 class="section-title">
                        <div class="section-icon">üë§</div>
                        Informations personnelles
                    </h3>
                    <div class="form-grid">
    <div style="display: flex; flex-direction: column;">
        <label for="prenom" style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.95rem;">
            Pr√©nom <span style="color: #e74c3c;">*</span>
        </label>
        <input type="text" id="prenom" name="prenom" required
               style="padding: 0.875rem 1rem; border: 2px solid var(--soft-gray); border-radius: 10px; font-size: 1rem; transition: all 0.3s; background: var(--white);">
    </div>
    
    <div style="display: flex; flex-direction: column;">
        <label for="nom" style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.95rem;">
            Nom <span style="color: #e74c3c;">*</span>
        </label>
        <input type="text" id="nom" name="nom" required
               style="padding: 0.875rem 1rem; border: 2px solid var(--soft-gray); border-radius: 10px; font-size: 1rem; transition: all 0.3s; background: var(--white);">
    </div>
    
    <div style="display: flex; flex-direction: column;">
        <label for="email" style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.95rem;">
            Email professionnel <span style="color: #e74c3c;">*</span>
        </label>
        <input type="email" id="email" name="email" required
               style="padding: 0.875rem 1rem; border: 2px solid var(--soft-gray); border-radius: 10px; font-size: 1rem; transition: all 0.3s; background: var(--white);">
        <div style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.25rem;">
            L'email sera utilis√© pour la connexion
        </div>
    </div>
    
    <div style="display: flex; flex-direction: column;">
        <label for="telephone" style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.95rem;">
            T√©l√©phone
        </label>
        <input type="tel" id="telephone" name="telephone"
               style="padding: 0.875rem 1rem; border: 2px solid var(--soft-gray); border-radius: 10px; font-size: 1rem; transition: all 0.3s; background: var(--white);">
    </div>
    
    <div style="display: flex; flex-direction: column;">
        <label for="date_naissance" style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.95rem;">
            Date de naissance
        </label>
        <input type="date" id="date_naissance" name="date_naissance"
               style="padding: 0.875rem 1rem; border: 2px solid var(--soft-gray); border-radius: 10px; font-size: 1rem; transition: all 0.3s; background: var(--white);">
    </div>
    
    <!-- NOUVEAU: Champ pour le d√©tail professionnel -->
    <div style="display: flex; flex-direction: column;">
        <label for="profession_detail" style="font-weight: 600; color: var(--text-dark); margin-bottom: 0.5rem; font-size: 0.95rem;">
            Profession d√©taill√©e <span style="color: #e74c3c;">*</span>
        </label>
        <select id="profession_detail" name="profession_detail" required
                style="padding: 0.875rem 1rem; border: 2px solid var(--soft-gray); border-radius: 10px; font-size: 1rem; background: var(--white); cursor: pointer;">
            <option value="">S√©lectionnez la profession</option>
            <option value="Aide √† domicile">Aide √† domicile</option>
            <option value="Aide-soignant">Aide-soignant</option>
            <option value="Auxiliaire de vie sociale">Auxiliaire de vie sociale</option>
            <option value="Infirmier">Infirmier</option>
            <option value="Responsable d'√©quipe">Responsable d'√©quipe</option>
            <option value="Coordinateur">Coordinateur</option>
            <option value="Assistant de soins en g√©rontologie">Assistant de soins en g√©rontologie</option>
            <option value="Accompagnant √©ducatif et social">Accompagnant √©ducatif et social</option>
            <option value="Autre">Autre</option>
        </select>
        <div style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.25rem;">
            Cette information appara√Ætra sur le certificat
        </div>
    </div>
</div>
                </div>

                <!-- Informations professionnelles -->
                <div class="form-section">
                    <h3 class="section-title">
                        <div class="section-icon">üíº</div>
                        Informations professionnelles
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="statut" class="form-label required">Statut</label>
                            <select id="statut" name="statut" class="form-select" required>
                                <option value="actif">Actif</option>
                                <option value="en_attente">En attente d'activation</option>
                                <option value="inactif">Inactif</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="role" class="form-label required">R√¥le dans le syst√®me</label>
                            <select id="role" name="role" class="form-select" required>
                                <option value="employe">Employ√©</option>
                                <option value="formateur">Formateur</option>
                                <option value="manager">Manager</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="mot_de_passe" class="form-label required">Mot de passe temporaire</label>
                            <input type="password" id="mot_de_passe" name="mot_de_passe" class="form-input" required>
                            <div class="form-help">Le salari√© devra changer ce mot de passe √† la premi√®re connexion</div>
                        </div>
                        <div class="form-group">
                            <label for="confirm_password" class="form-label required">Confirmer le mot de passe</label>
                            <input type="password" id="confirm_password" name="confirm_password" class="form-input" required>
                        </div>
                    </div>
                </div>

                <!-- Aper√ßu du profil -->
                <div class="form-section">
                    <h3 class="section-title">
                        <div class="section-icon">üëÅÔ∏è</div>
                        Aper√ßu du profil
                    </h3>
                    <div class="profile-preview">
                        <div class="avatar-preview" id="avatarPreview">
                            ?
                        </div>
                        <div class="preview-info">
                            <h4 id="namePreview">Pr√©nom Nom</h4>
                            <p id="emailPreview">email@exemple.com</p>
                            <p id="rolePreview">Profil professionnel</p>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="button-group">
                    <a href="/entreprise/salaries" class="btn btn-secondary">
                        ‚Üê Annuler
                    </a>
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <span>üíæ Ajouter le salari√©</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Variables globales
        const form = document.getElementById('addEmployeeForm');
        const submitBtn = document.getElementById('submitBtn');
        const successAlert = document.getElementById('successAlert');
        const errorAlert = document.getElementById('errorAlert');
        const errorMessage = document.getElementById('errorMessage');

        // √âl√©ments de l'aper√ßu
        const avatarPreview = document.getElementById('avatarPreview');
        const namePreview = document.getElementById('namePreview');
        const emailPreview = document.getElementById('emailPreview');
        const rolePreview = document.getElementById('rolePreview');

        // Mise √† jour de l'aper√ßu en temps r√©el
       function updatePreview() {
            const prenom = document.getElementById('prenom').value || 'Pr√©nom';
            const nom = document.getElementById('nom').value || 'Nom';
            const email = document.getElementById('email').value || 'email@exemple.com';
            const professionDetail = document.getElementById('profession_detail').value;

            // Mise √† jour de l'avatar
            if (prenom && nom && prenom !== 'Pr√©nom' && nom !== 'Nom') {
                avatarPreview.textContent = prenom.charAt(0).toUpperCase() + nom.charAt(0).toUpperCase();
            } else {
                avatarPreview.textContent = '?';
            }

            // Mise √† jour des informations
            namePreview.textContent = `${prenom} ${nom}`;
            emailPreview.textContent = email;
            
            rolePreview.textContent = professionDetail || 'Profil professionnel';
        }
        
        // √âcouteurs pour la mise √† jour de l'aper√ßu
        ['prenom', 'nom', 'email', 'profession_detail'].forEach(id => {
            document.getElementById(id).addEventListener('input', updatePreview);
        });

        // Validation en temps r√©el
        function validateField(field) {
            const value = field.value.trim();
            const isValid = field.checkValidity();
            
            if (isValid) {
                field.style.borderColor = 'var(--primary-blue)';
            } else {
                field.style.borderColor = '#e74c3c';
            }
            
            return isValid;
        }

        // Validation du mot de passe
        function validatePasswords() {
            const password = document.getElementById('mot_de_passe').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            const confirmField = document.getElementById('confirm_password');
            
            if (password && confirmPassword && password !== confirmPassword) {
                confirmField.style.borderColor = '#e74c3c';
                return false;
            } else if (password && confirmPassword && password === confirmPassword) {
                confirmField.style.borderColor = 'var(--primary-blue)';
                return true;
            }
            return true;
        }

        // Validation de l'email
        function validateEmail() {
            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const emailField = document.getElementById('email');
            
            if (email && !emailRegex.test(email)) {
                emailField.style.borderColor = '#e74c3c';
                return false;
            } else if (email && emailRegex.test(email)) {
                emailField.style.borderColor = 'var(--primary-blue)';
                return true;
            }
            return true;
        }

        // √âcouteurs de validation
        document.querySelectorAll('.form-input, .form-select').forEach(field => {
            field.addEventListener('blur', () => validateField(field));
            field.addEventListener('input', () => {
                if (field.id === 'email') validateEmail();
                if (field.id === 'confirm_password' || field.id === 'mot_de_passe') validatePasswords();
            });
        });

        // Affichage des alertes
        function showAlert(type, message) {
            hideAlerts();
            
            if (type === 'success') {
                successAlert.style.display = 'block';
            } else {
                errorMessage.textContent = message;
                errorAlert.style.display = 'block';
            }
            
            // Scroll vers le haut pour voir l'alerte
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideAlerts() {
            successAlert.style.display = 'none';
            errorAlert.style.display = 'none';
        }

        // Soumission du formulaire
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            hideAlerts();

            // Validation compl√®te
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);

            // V√©rifications
            if (!data.prenom || !data.nom || !data.email) {
                showAlert('error', 'Veuillez remplir tous les champs obligatoires.');
                return;
            }

            if (!validateEmail()) {
                showAlert('error', 'Veuillez entrer une adresse email valide.');
                return;
            }

            if (!validatePasswords()) {
                showAlert('error', 'Les mots de passe ne correspondent pas.');
                return;
            }

            if (data.mot_de_passe.length < 6) {
                showAlert('error', 'Le mot de passe doit contenir au moins 6 caract√®res.');
                return;
            }

            // Changement du bouton
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>‚è≥ Ajout en cours...</span>';

            try {
                const response = await fetch('/entreprise/salaries/nouveau', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('success', 'Le salari√© a √©t√© ajout√© avec succ√®s !');
                    
                    // Redirection apr√®s 2 secondes
                    setTimeout(() => {
                        window.location.href = '/entreprise/salaries';
                    }, 2000);
                    
                } else {
                    showAlert('error', result.message || 'Une erreur est survenue lors de l\'ajout.');
                }
            } catch (error) {
                console.error('Erreur:', error);
                showAlert('error', 'Erreur de connexion. Veuillez r√©essayer.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<span>üíæ Ajouter le salari√©</span>';
            }
        });

        // Initialisation
        updatePreview();
    </script>
</body>
</html>