<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord | ADSIAM Formations</title>
    <link rel="stylesheet" href="/css/dashboard-etudiant.css">
</head>
<body>
    <!-- Header -->
    <%- include('../partials/header-etudiant') %>

    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar slide-in">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Navigation</h3>
                <ul class="sidebar-menu">
                    <li><a href="/etudiant/dashboard" class="active"><span class="icon">🏠</span> Tableau de bord</a></li>
                    <li><a href="/etudiant/formations"><span class="icon">📚</span> Mes formations</a></li>
                    <li><a href="#"><span class="icon">📊</span> Progression</a></li>
                    <li><a href="/etudiant/planning"><span class="icon">📅</span> Planning</a></li>
                    <li><a href="#"><span class="icon">🎓</span> Certifications</a></li>
                    <li><a href="#"><span class="icon">💬</span> Messagerie</a></li>
                    <li><a href="#"><span class="icon">👥</span> Communauté</a></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-title">Support</h3>
                <ul class="sidebar-menu">
                    <li><a href="#"><span class="icon">❓</span> Centre d'aide</a></li>
                    <li><a href="#"><span class="icon">🎧</span> Support technique</a></li>
                    <li><a href="../Visiteurs/contact"><span class="icon">📞</span> Contact</a></li>
                </ul>
            </div>

            <div class="quick-stats">
                <span class="stat-number"><%= user.progressionGlobale || 0 %>%</span>
                <span class="stat-label">Progression globale</span>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <!-- Welcome Banner -->
            <section class="welcome-banner fade-in">
                <div class="welcome-content">
                    <h1 class="welcome-title">Bonjour <%= user.prenom %> ! 👋</h1>
                    <p class="welcome-subtitle">Bienvenue sur votre espace de formation ADSIAM. Continuez votre parcours d'excellence.</p>
                    
                    <div class="welcome-stats">
                        <% user.stats.forEach(stat => { %>
                        <div class="welcome-stat">
                            <span class="welcome-stat-number"><%= stat.value %></span>
                            <span class="welcome-stat-label"><%= stat.label %></span>
                        </div>
                        <% }) %>
                    </div>
                </div>
            </section>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid">

                <!-- Formations en cours -->
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h2 class="card-title"><span class="card-icon">📚</span> Formations en cours</h2>
                        <a href="#" class="card-action">Voir tout →</a>
                    </div>

                    <% progressions.forEach(progress => { %>
                    <div class="progress-item">
                        <div class="progress-header">
                            <span class="progress-title"><%= progress.titre %></span>
                            <span class="progress-percentage"><%= progress.progression_pourcentage %>%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: <%= progress.progression_pourcentage %>%"></div>
                        </div>
                        <div class="progress-meta">
                            <span>Module <%= progress.moduleActuel %>/<%= progress.modulesTotal %></span>
                            <span>Reste <%= progress.tempsRestant %></span>
                        </div>
                    </div>
                    <% }) %>
                </div>

                <!-- Activité récente -->
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h2 class="card-title"><span class="card-icon">🕐</span> Activité récente</h2>
                    </div>
                    <% user.activites.forEach(act => { %>
                    <div class="activity-item">
                        <div class="activity-icon"><%= act.icon %></div>
                        <div class="activity-content">
                            <div class="activity-title"><%= act.titre %></div>
                            <div class="activity-description"><%= act.description %></div>
                            <div class="activity-time"><%= act.date %></div>
                        </div>
                    </div>
                    <% }) %>
                </div>

                <!-- Actions rapides -->
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h2 class="card-title"><span class="card-icon">⚡</span> Actions rapides</h2>
                    </div>
                    <% user.actionsRapides.forEach(action => { %>
                    <a href="<%= action.url %>" class="quick-action">
                        <span class="quick-action-icon"><%= action.icon %></span>
                        <span class="quick-action-title"><%= action.label %></span>
                    </a>
                    <% }) %>
                </div>

                <!-- Prochains événements -->
                <div class="dashboard-card fade-in">
                    <div class="card-header">
                        <h2 class="card-title"><span class="card-icon">📅</span> Prochains événements</h2>
                        <a href="/etudiant/planning" class="card-action">Planning complet →</a>
                    </div>
                    <% user.evenements.forEach(evt => { %>
                    <div class="event-item">
                        <div class="event-date">
                            <span class="event-day"><%= evt.jour %></span>
                            <span class="event-month"><%= evt.mois %></span>
                        </div>
                        <div class="event-content">
                            <div class="event-title"><%= evt.titre %></div>
                            <div class="event-time"><%= evt.heure %> • <%= evt.lieu %></div>
                        </div>
                    </div>
                    <% }) %>
                </div>

            </div>
        </main>
    </div>

    <%- include('../partials/footer') %>
    <script>
        // Toggle profile dropdown
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const profile = document.querySelector('.profile-avatar');
            const dropdown = document.getElementById('profileDropdown');
            
            if (!profile.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        });

        // Animation des barres de progression
        function animateProgressBars() {
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach((bar, index) => {
                setTimeout(() => {
                    bar.style.transform = 'scaleX(1)';
                }, index * 200);
            });
        }

        // Animation au scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    if (entry.target.classList.contains('slide-in')) {
                        entry.target.style.animation = 'slideInLeft 0.6s ease forwards';
                    } else {
                        entry.target.style.animation = 'fadeInUp 0.6s ease forwards';
                    }
                }
            });
        }, observerOptions);

        document.querySelectorAll('.fade-in, .slide-in').forEach(el => {
            observer.observe(el);
        });

        // Interactions des éléments
        document.querySelectorAll('.activity-item').forEach(item => {
            item.addEventListener('click', () => {
                const title = item.querySelector('.activity-title').textContent;
                alert(`Action : ${title}\nRedirection vers les détails...`);
            });
        });

        document.querySelectorAll('.progress-item').forEach(item => {
            item.addEventListener('click', () => {
                const title = item.querySelector('.progress-title').textContent;
                alert(`Reprendre la formation : ${title}`);
            });
        });

        document.querySelectorAll('.event-item').forEach(item => {
            item.addEventListener('click', () => {
                const title = item.querySelector('.event-title').textContent;
                alert(`Détails de l'événement : ${title}`);
            });
        });

        // Initialisation
        window.addEventListener('load', () => {
            animateProgressBars();
            console.log('🎯 Tableau de bord ADSIAM chargé');
            console.log('👤 Utilisateur: Sophie Martin');
            console.log('📊 5 formations actives, 78% de progression globale');
        });
    </script>
</body>
</html>