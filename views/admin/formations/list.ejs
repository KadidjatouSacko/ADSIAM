<!-- views/admin/formations/list.ejs -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <div class="admin-layout">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>ADSIAM Admin</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="/admin">üìä Tableau de bord</a></li>
                <li><a href="/admin/utilisateurs">üë• Utilisateurs</a></li>
                <li><a href="/admin/formations" class="active">üìö Formations</a></li>
                <li><a href="/admin/inscriptions">üìù Inscriptions</a></li>
                <li><a href="/admin/evenements">üìÖ √âv√©nements</a></li>
                <li><a href="/admin/rapports">üìä Rapports</a></li>
                <li><a href="/admin/messagerie">üí¨ Messagerie</a></li>
                <li><a href="/admin/parametres">‚öôÔ∏è Param√®tres</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="content-header">
                <h1>Gestion des formations</h1>
                <div class="header-actions">
                    <a href="/admin/formations/nouvelle" class="btn btn-primary">‚ûï Nouvelle formation</a>
                </div>
            </div>

            <div class="filters-section">
                <form class="filters-form" method="GET">
                    <div class="filter-group">
                        <input type="text" name="search" placeholder="Rechercher..." value="<%= filters.search %>" class="form-input">
                    </div>
                    <div class="filter-group">
                        <select name="domaine" class="form-select">
                            <option value="">Tous les domaines</option>
                            <option value="communication" <%= filters.domaine === 'communication' ? 'selected' : '' %>>Communication</option>
                            <option value="hygiene" <%= filters.domaine === 'hygiene' ? 'selected' : '' %>>Hygi√®ne</option>
                            <option value="ergonomie" <%= filters.domaine === 'ergonomie' ? 'selected' : '' %>>Ergonomie</option>
                            <option value="urgences" <%= filters.domaine === 'urgences' ? 'selected' : '' %>>Urgences</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select name="niveau" class="form-select">
                            <option value="">Tous les niveaux</option>
                            <option value="debutant" <%= filters.niveau === 'debutant' ? 'selected' : '' %>>D√©butant</option>
                            <option value="intermediaire" <%= filters.niveau === 'intermediaire' ? 'selected' : '' %>>Interm√©diaire</option>
                            <option value="avance" <%= filters.niveau === 'avance' ? 'selected' : '' %>>Avanc√©</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-secondary">Filtrer</button>
                </form>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Titre</th>
                            <th>Domaine</th>
                            <th>Niveau</th>
                            <th>Prix</th>
                            <th>Statut</th>
                            <th>Date de cr√©ation</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% formations.forEach(formation => { %>
                        <tr>
                            <td><%= formation.id %></td>
                            <td><%= formation.titre %></td>
                            <td>
                                <span class="badge badge-<%= formation.domaine %>"><%= formation.domaine %></span>
                            </td>
                            <td><%= formation.niveau %></td>
                            <td>
                                <% if (formation.prix === 0) { %>
                                    <span class="badge badge-success">Gratuit</span>
                                <% } else { %>
                                    <%= formation.prix %>‚Ç¨
                                <% } %>
                            </td>
                            <td>
                                <span class="status status-<%= formation.actif ? 'actif' : 'inactif' %>">
                                    <%= formation.actif ? 'Active' : 'Inactive' %>
                                </span>
                            </td>
                            <td><%= new Date(formation.createdAt).toLocaleDateString('fr-FR') %></td>
                            <td class="actions">
                                <a href="/admin/formations/<%= formation.id %>/modifier" class="btn-icon" title="Modifier">‚úèÔ∏è</a>
                                <button onclick="toggleFormationStatus(<%= formation.id %>)" class="btn-icon" title="Changer statut">üîÑ</button>
                                <button onclick="deleteFormation(<%= formation.id %>)" class="btn-icon btn-danger" title="Supprimer">üóëÔ∏è</button>
                            </td>
                        </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>

            <div class="pagination-container">
                <div class="pagination-info">
                    Affichage de <%= (pagination.currentPage - 1) * 20 + 1 %> √† <%= Math.min(pagination.currentPage * 20, pagination.total) %> sur <%= pagination.total %> formations
                </div>
                <div class="pagination">
                    <% if (pagination.hasPrev) { %>
                        <a href="?page=<%= pagination.currentPage - 1 %>" class="btn btn-pagination">‚Üê Pr√©c√©dent</a>
                    <% } %>
                    
                    <% for (let i = Math.max(1, pagination.currentPage - 2); i <= Math.min(pagination.totalPages, pagination.currentPage + 2); i++) { %>
                        <a href="?page=<%= i %>" class="btn btn-pagination <%= i === pagination.currentPage ? 'active' : '' %>"><%= i %></a>
                    <% } %>
                    
                    <% if (pagination.hasNext) { %>
                        <a href="?page=<%= pagination.currentPage + 1 %>" class="btn btn-pagination">Suivant ‚Üí</a>
                    <% } %>
                </div>
            </div>
        </main>
    </div>

    <script>
        function toggleFormationStatus(formationId) {
            if (confirm('Changer le statut de cette formation ?')) {
                fetch(`/admin/api/formations/${formationId}/toggle-status`, {
                    method: 'PATCH'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Erreur: ' + data.error);
                    }
                });
            }
        }

        function deleteFormation(formationId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette formation ?')) {
                fetch(`/admin/formations/${formationId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Erreur: ' + data.error);
                    }
                });
            }
        }
    </script>
</body>
</html>