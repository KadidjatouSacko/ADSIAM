<!-- views/admin/users/create.ejs -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar (m√™me que dans list.ejs) -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>ADSIAM Admin</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="/admin">üìä Tableau de bord</a></li>
                <li><a href="/admin/utilisateurs" class="active">üë• Utilisateurs</a></li>
                <li><a href="/admin/formations">üìö Formations</a></li>
                <li><a href="/admin/inscriptions">üìù Inscriptions</a></li>
                <li><a href="/admin/evenements">üìÖ √âv√©nements</a></li>
                <li><a href="/admin/rapports">üìä Rapports</a></li>
                <li><a href="/admin/messagerie">üí¨ Messagerie</a></li>
                <li><a href="/admin/parametres">‚öôÔ∏è Param√®tres</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <h1>Cr√©er un nouvel utilisateur</h1>
                <div class="header-actions">
                    <a href="/admin/utilisateurs" class="btn btn-secondary">‚Üê Retour √† la liste</a>
                </div>
            </div>

            <% if (typeof error !== 'undefined' && error) { %>
                <div class="alert alert-error">
                    <%= error %>
                </div>
            <% } %>

            <div class="form-container">
                <form action="/admin/utilisateurs/nouveau" method="POST" class="admin-form" enctype="multipart/form-data">
                    <div class="form-section">
                        <h3>Informations personnelles</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="prenom" class="form-label required">Pr√©nom</label>
                                <input type="text" id="prenom" name="prenom" class="form-input" 
                                       value="<%= typeof formData !== 'undefined' ? formData.prenom || '' : '' %>" required>
                            </div>
                            <div class="form-group">
                                <label for="nom" class="form-label required">Nom</label>
                                <input type="text" id="nom" name="nom" class="form-input" 
                                       value="<%= typeof formData !== 'undefined' ? formData.nom || '' : '' %>" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="email" class="form-label required">Email</label>
                                <input type="email" id="email" name="email" class="form-input" 
                                       value="<%= typeof formData !== 'undefined' ? formData.email || '' : '' %>" required>
                            </div>
                            <div class="form-group">
                                <label for="telephone" class="form-label">T√©l√©phone</label>
                                <input type="tel" id="telephone" name="telephone" class="form-input" 
                                       value="<%= typeof formData !== 'undefined' ? formData.telephone || '' : '' %>">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="mot_de_passe" class="form-label required">Mot de passe</label>
                            <input type="password" id="mot_de_passe" name="mot_de_passe" class="form-input" required>
                            <small class="form-help">Minimum 8 caract√®res</small>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Informations professionnelles</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="role" class="form-label required">R√¥le</label>
                                <select id="role" name="role" class="form-select" required>
                                    <option value="">S√©lectionner un r√¥le</option>
                                    <option value="apprenant" <%= (typeof formData !== 'undefined' && formData.role === 'apprenant') ? 'selected' : '' %>>Apprenant</option>
                                    <option value="formateur" <%= (typeof formData !== 'undefined' && formData.role === 'formateur') ? 'selected' : '' %>>Formateur</option>
                                    <option value="admin" <%= (typeof formData !== 'undefined' && formData.role === 'admin') ? 'selected' : '' %>>Administrateur</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="type_utilisateur" class="form-label">Type d'utilisateur</label>
                                <select id="type_utilisateur" name="type_utilisateur" class="form-select">
                                    <option value="aide_domicile" <%= (typeof formData !== 'undefined' && formData.type_utilisateur === 'aide_domicile') ? 'selected' : '' %>>Aide √† domicile</option>
                                    <option value="aide_soignant" <%= (typeof formData !== 'undefined' && formData.type_utilisateur === 'aide_soignant') ? 'selected' : '' %>>Aide-soignant</option>
                                    <option value="formateur" <%= (typeof formData !== 'undefined' && formData.type_utilisateur === 'formateur') ? 'selected' : '' %>>Formateur</option>
                                    <option value="etudiant" <%= (typeof formData !== 'undefined' && formData.type_utilisateur === 'etudiant') ? 'selected' : '' %>>√âtudiant</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="etablissement" class="form-label">√âtablissement</label>
                                <input type="text" id="etablissement" name="etablissement" class="form-input" 
                                       value="<%= typeof formData !== 'undefined' ? formData.etablissement || '' : '' %>">
                            </div>
                            <div class="form-group">
                                <label for="ville" class="form-label">Ville</label>
                                <input type="text" id="ville" name="ville" class="form-input" 
                                       value="<%= typeof formData !== 'undefined' ? formData.ville || '' : '' %>">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="experience" class="form-label">Exp√©rience (ann√©es)</label>
                            <input type="number" id="experience" name="experience" class="form-input" min="0" max="50"
                                   value="<%= typeof formData !== 'undefined' ? formData.experience || '' : '' %>">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">‚úÖ Cr√©er l'utilisateur</button>
                        <a href="/admin/utilisateurs" class="btn btn-secondary">‚ùå Annuler</a>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <script>
        // Validation c√¥t√© client
        document.querySelector('.admin-form').addEventListener('submit', function(e) {
            const password = document.getElementById('mot_de_passe').value;
            if (password.length < 8) {
                e.preventDefault();
                alert('Le mot de passe doit contenir au moins 8 caract√®res');
                return false;
            }
            
            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                e.preventDefault();
                alert('Veuillez entrer un email valide');
                return false;
            }
        });

        // Auto-compl√©tion du r√¥le bas√© sur le type d'utilisateur
        document.getElementById('type_utilisateur').addEventListener('change', function() {
            const role = document.getElementById('role');
            if (this.value === 'formateur') {
                role.value = 'formateur';
            } else if (this.value !== 'formateur' && role.value === 'formateur') {
                role.value = 'apprenant';
            }
        });
    </script>
</body>
</html>