
<% contentFor('head') -%>
<title>Événements | ADSIAM</title>
<% contentFor('scripts') -%>

<style>
.evenements-container {
    padding: 2rem;
    max-width: 1600px;
    margin: 0 auto;
}

.evenements-header {
    background: var(--white);
    padding: 3rem;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow);
    text-align: center;
    margin-bottom: 3rem;
    position: relative;
    overflow: hidden;
}

.evenements-header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -30%;
    width: 60%;
    height: 200%;
    background: var(--gradient-orange);
    border-radius: 50%;
    opacity: 0.1;
    transform: rotate(15deg);
}

.header-content {
    position: relative;
    z-index: 2;
}

.header-title {
    font-size: 3rem;
    font-weight: 300;
    color: var(--text-dark);
    margin-bottom: 1rem;
}

.header-subtitle {
    font-size: 1.2rem;
    color: var(--text-light);
    margin-bottom: 2rem;
    line-height: 1.7;
}

.calendar-widget {
    display: inline-flex;
    align-items: center;
    gap: 0.8rem;
    background: var(--gradient-blue);
    color: white;
    padding: 1rem 2rem;
    border-radius: 50px;
    font-weight: 600;
    font-size: 1.1rem;
}

.evenements-filters {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 3rem;
    flex-wrap: wrap;
}

.filter-event-btn {
    padding: 0.8rem 1.5rem;
    border: 2px solid var(--soft-gray);
    background: var(--white);
    border-radius: 25px;
    cursor: pointer;
    transition: var(--transition);
    font-weight: 500;
    color: var(--text-dark);
    box-shadow: var(--shadow);
}

.filter-event-btn.active {
    background: var(--gradient-orange);
    color: white;
    border-color: transparent;
    box-shadow: 0 8px 25px rgba(255, 159, 128, 0.3);
}

.filter-event-btn:hover:not(.active) {
    background: var(--light-blue);
    border-color: var(--primary-blue);
}

.view-toggle {
    display: flex;
    justify-content: center;
    margin-bottom: 2rem;
}

.view-btn {
    padding: 0.8rem 1.5rem;
    border: 2px solid var(--primary-blue);
    background: var(--white);
    color: var(--primary-blue);
    cursor: pointer;
    transition: var(--transition);
    font-weight: 500;
}

.view-btn:first-child {
    border-radius: 25px 0 0 25px;
    border-right: 1px solid var(--primary-blue);
}

.view-btn:last-child {
    border-radius: 0 25px 25px 0;
    border-left: 1px solid var(--primary-blue);
}

.view-btn.active {
    background: var(--primary-blue);
    color: white;
}

.events-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 2rem;
}

.event-card {
    background: var(--white);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: var(--transition);
    cursor: pointer;
    position: relative;
}

.event-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg);
}

.event-header {
    height: 200px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    color: white;
}

.event-card:nth-child(4n+1) .event-header { background: var(--gradient-orange); }
.event-card:nth-child(4n+2) .event-header { background: var(--gradient-blue); }
.event-card:nth-child(4n+3) .event-header { background: var(--gradient-green); }
.event-card:nth-child(4n+4) .event-header { background: var(--gradient-contact); }

.event-header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
    animation: eventPulse 6s ease-in-out infinite;
}

@keyframes eventPulse {
    0%, 100% { opacity: 0.3; transform: scale(1) rotate(0deg); }
    50% { opacity: 0.6; transform: scale(1.1) rotate(180deg); }
}

.event-icon {
    font-size: 4rem;
    z-index: 2;
}

.event-date-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(255, 255, 255, 0.95);
    color: var(--text-dark);
    padding: 0.8rem;
    border-radius: 15px;
    text-align: center;
    font-weight: 600;
    backdrop-filter: blur(10px);
    min-width: 70px;
}

.event-day {
    font-size: 1.8rem;
    line-height: 1;
    margin-bottom: 0.2rem;
}

.event-month {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.event-status {
    position: absolute;
    top: 1rem;
    left: 1rem;
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    backdrop-filter: blur(10px);
}

.status-upcoming {
    background: rgba(40, 167, 69, 0.9);
    color: white;
}

.status-live {
    background: rgba(220, 53, 69, 0.9);
    color: white;
    animation: pulse 2s infinite;
}

.status-full {
    background: rgba(255, 193, 7, 0.9);
    color: var(--text-dark);
}

.event-content {
    padding: 2.5rem;
}

.event-type {
    display: inline-block;
    padding: 0.3rem 1rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.type-webinaire {
    background: var(--light-blue);
    color: var(--primary-blue);
}

.type-atelier {
    background: var(--light-pink);
    color: var(--primary-pink);
}

.type-conference {
    background: #e2f8ee;
    color: #28a745;
}

.event-title {
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 1rem;
    line-height: 1.3;
}

.event-description {
    color: var(--text-light);
    margin-bottom: 1.5rem;
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.event-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 2rem;
}

.event-detail {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-light);
}

.detail-icon {
    color: var(--primary-blue);
    font-size: 1rem;
}

.event-participants {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    padding: 1rem;
    background: var(--soft-gray);
    border-radius: var(--border-radius);
}

.participants-count {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-dark);
    font-weight: 500;
}

.participants-avatars {
    display: flex;
    margin-left: -5px;
}

.participant-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: var(--gradient-contact);
    border: 2px solid white;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.7rem;
    font-weight: 600;
    margin-left: -5px;
}

.more-participants {
    background: var(--text-light);
    font-size: 0.6rem;
}

.event-actions {
    display: flex;
    gap: 1rem;
}

.event-btn {
    flex: 1;
    padding: 1rem 1.5rem;
    border: none;
    border-radius: var(--border-radius);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    text-align: center;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-inscription {
    background: var(--gradient-orange);
    color: white;
}

.btn-inscription:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 159, 128, 0.4);
}

.btn-inscription:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.btn-details {
    background: transparent;
    color: var(--primary-blue);
    border: 2px solid var(--primary-blue);
}

.btn-details:hover {
    background: var(--primary-blue);
    color: white;
}

.btn-rejoindre {
    background: var(--gradient-green);
    color: white;
    animation: pulse 2s infinite;
}

.calendar-view {
    display: none;
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow);
    padding: 2rem;
}

.calendar-view.active {
    display: block;
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.calendar-nav {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.calendar-nav-btn {
    background: var(--soft-gray);
    border: none;
    padding: 0.8rem;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-dark);
}

.calendar-nav-btn:hover {
    background: var(--primary-blue);
    color: white;
}

.calendar-month {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-dark);
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background: var(--soft-gray);
    border-radius: var(--border-radius);
    overflow: hidden;
}

.calendar-day {
    background: var(--white);
    padding: 1rem 0.5rem;
    min-height: 100px;
    position: relative;
    border: 1px solid var(--soft-gray);
}

.calendar-day-header {
    background: var(--soft-gray);
    padding: 0.8rem;
    text-align: center;
    font-weight: 600;
    color: var(--text-dark);
    font-size: 0.9rem;
}

.calendar-day-number {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
}

.calendar-day.other-month .calendar-day-number {
    color: var(--text-light);
    opacity: 0.5;
}

.calendar-day.today {
    background: var(--light-blue);
}

.calendar-day.today .calendar-day-number {
    background: var(--primary-blue);
    color: white;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
}

.calendar-event {
    background: var(--gradient-orange);
    color: white;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    margin-bottom: 0.2rem;
    cursor: pointer;
    transition: var(--transition);
}

.calendar-event:hover {
    transform: scale(1.05);
}

.calendar-event.webinaire {
    background: var(--gradient-blue);
}

.calendar-event.atelier {
    background: var(--gradient-pink);
}

.calendar-event.conference {
    background: var(--gradient-green);
}

.empty-events {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--white);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow);
    grid-column: 1 / -1;
}

.empty-events-icon {
    font-size: 5rem;
    margin-bottom: 2rem;
    opacity: 0.3;
}

.empty-events-title {
    font-size: 1.8rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 1rem;
}

.empty-events-description {
    color: var(--text-light);
    margin-bottom: 2.5rem;
    line-height: 1.7;
    font-size: 1.1rem;
}

@media (max-width: 768px) {
    .evenements-container {
        padding: 1rem;
    }
    
    .evenements-header {
        padding: 2rem;
    }
    
    .header-title {
        font-size: 2rem;
    }
    
    .events-grid {
        grid-template-columns: 1fr;
    }
    
    .event-details {
        grid-template-columns: 1fr;
    }
    
    .event-actions {
        flex-direction: column;
    }
    
    .calendar-grid {
        grid-template-columns: repeat(7, 1fr);
        font-size: 0.8rem;
    }
    
    .calendar-day {
        min-height: 80px;
        padding: 0.5rem 0.25rem;
    }
    
    .evenements-filters {
        flex-direction: column;
        align-items: center;
    }
}
</style>

<div class="dashboard-layout">
    <%- include('../partials/sidebar') %>
    
    <main class="main-content">
        <%- include('../partials/header', { 
            pageTitle: 'Événements', 
            pageIcon: '📅',
            pageSubtitle: 'Webinaires, ateliers et conférences ADSIAM',
            showSearch: false 
        }) %>
        
        <div class="evenements-container">
            <!-- Header -->
            <div class="evenements-header fade-in">
                <div class="header-content">
                    <h1 class="header-title">Événements ADSIAM</h1>
                    <p class="header-subtitle">
                        Participez à nos webinaires, ateliers pratiques et conférences.<br>
                        Échangez avec des experts et enrichissez vos compétences professionnelles.
                    </p>
                    <div class="calendar-widget">
                        📅 <%= new Date().toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' }) %>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="evenements-filters">
                <button class="filter-event-btn active" data-filter="all">Tous les événements</button>
                <button class="filter-event-btn" data-filter="webinaire">Webinaires</button>
                <button class="filter-event-btn" data-filter="atelier">Ateliers pratiques</button>
                <button class="filter-event-btn" data-filter="conference">Conférences</button>
                <button class="filter-event-btn" data-filter="upcoming">À venir</button>
                <button class="filter-event-btn" data-filter="inscrit">Mes inscriptions</button>
            </div>

            <!-- View Toggle -->
            <div class="view-toggle">
                <button class="view-btn active" data-view="grid">📊 Vue grille</button>
                <button class="view-btn" data-view="calendar">📅 Vue calendrier</button>
            </div>

            <!-- Events Grid -->
            <div class="events-grid" id="eventsGrid">
                <% if (evenements && evenements.length > 0) { %>
                    <% evenements.forEach((event, index) => { %>
                        <div class="event-card fade-in" 
                             data-type="<%= event.type_evenement %>"
                             data-status="<%= event.statut %>"
                             data-date="<%= new Date(event.date_debut).getTime() %>"
                             data-inscrit="<%= event.user_inscrit ? 'true' : 'false' %>">
                            
                            <div class="event-header">
                                <div class="event-icon">
                                    <% if (event.type_evenement === 'webinaire') { %>
                                        💻
                                    <% } else if (event.type_evenement === 'atelier') { %>
                                        🛠️
                                    <% } else { %>
                                        🎯
                                    <% } %>
                                </div>
                                
                                <div class="event-date-badge">
                                    <div class="event-day">
                                        <%= new Date(event.date_debut).toLocaleDateString('fr-FR', { day: '2-digit' }) %>
                                    </div>
                                    <div class="event-month">
                                        <%= new Date(event.date_debut).toLocaleDateString('fr-FR', { month: 'short' }) %>
                                    </div>
                                </div>
                                
                                <div class="event-status status-<%= event.statut %>">
                                    <% if (event.statut === 'upcoming') { %>
                                        🟢 À venir
                                    <% } else if (event.statut === 'live') { %>
                                        🔴 En direct
                                    <% } else if (event.statut === 'full') { %>
                                        ⚠️ Complet
                                    <% } else { %>
                                        ✅ Terminé
                                    <% } %>
                                </div>
                            </div>
                            
                            <div class="event-content">
                                <span class="event-type type-<%= event.type_evenement %>">
                                    <%= event.type_evenement === 'webinaire' ? 'Webinaire' : 
                                        (event.type_evenement === 'atelier' ? 'Atelier Pratique' : 'Conférence') %>
                                </span>
                                
                                <h3 class="event-title"><%= event.titre %></h3>
                                
                                <p class="event-description">
                                    <%= event.description %>
                                </p>
                                
                                <div class="event-details">
                                    <div class="event-detail">
                                        <span class="detail-icon">🕒</span>
                                        <span>
                                            <%= new Date(event.date_debut).toLocaleDateString('fr-FR', {
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            }) %>
                                        </span>
                                    </div>
                                    <div class="event-detail">
                                        <span class="detail-icon">⏱️</span>
                                        <span>
                                            <%= Math.round((new Date(event.date_fin) - new Date(event.date_debut)) / 60000) %> min
                                        </span>
                                    </div>
                                    <div class="event-detail">
                                        <span class="detail-icon">
                                            <% if (event.lieu) { %>
                                                📍
                                            <% } else { %>
                                                💻
                                            <% } %>
                                        </span>
                                        <span>
                                            <%= event.lieu || 'En ligne' %>
                                        </span>
                                    </div>
                                    <div class="event-detail">
                                        <span class="detail-icon">👨‍🏫</span>
                                        <span>
                                            <%= event.formateur_nom || 'Expert ADSIAM' %>
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="event-participants">
                                    <div class="participants-count">
                                        👥 <%= event.participants_count || 0 %>/<%= event.max_participants || 50 %> participants
                                    </div>
                                    <div class="participants-avatars">
                                        <% if (event.participants && event.participants.length > 0) { %>
                                            <% event.participants.slice(0, 4).forEach(participant => { %>
                                                <div class="participant-avatar">
                                                    <%= participant.prenom ? participant.prenom.charAt(0).toUpperCase() : '👤' %>
                                                </div>
                                            <% }) %>
                                            <% if (event.participants.length > 4) { %>
                                                <div class="participant-avatar more-participants">
                                                    +<%= event.participants.length - 4 %>
                                                </div>
                                            <% } %>
                                        <% } %>
                                    </div>
                                </div>
                                
                                <div class="event-actions">
                                    <% if (event.statut === 'live') { %>
                                        <a href="<%= event.lien_visio %>" class="event-btn btn-rejoindre" target="_blank">
                                            🔴 Rejoindre maintenant
                                        </a>
                                    <% } else if (event.user_inscrit) { %>
                                        <button class="event-btn btn-inscription" disabled>
                                            ✅ Inscrit
                                        </button>
                                        <button class="event-btn btn-details" onclick="voirEvenement('<%= event.id %>')">
                                            👁️ Détails
                                        </button>
                                    <% } else if (event.statut === 'full') { %>
                                        <button class="event-btn btn-inscription" disabled>
                                            ⚠️ Complet
                                        </button>
                                        <button class="event-btn btn-details" onclick="voirEvenement('<%= event.id %>')">
                                            📋 Liste d'attente
                                        </button>
                                    <% } else { %>
                                        <button class="event-btn btn-inscription" onclick="inscrireEvenement('<%= event.id %>')">
                                            📝 S'inscrire
                                        </button>
                                        <button class="event-btn btn-details" onclick="voirEvenement('<%= event.id %>')">
                                            👁️ Détails
                                        </button>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div class="empty-events fade-in">
                        <div class="empty-events-icon">📅</div>
                        <h3 class="empty-events-title">Aucun événement prévu</h3>
                        <p class="empty-events-description">
                            Les prochains webinaires et ateliers seront bientôt annoncés.<br>
                            Restez connecté pour ne rien manquer !
                                                </p>
                    </div>
                <% } %>
            </div>
            <!-- Fin Events Grid -->

            <!-- Calendar View (à compléter selon tes besoins) -->
            <div class="calendar-view" id="calendarView">
                <!-- Ici tu peux ajouter ton widget calendrier dynamique -->
                <div class="empty-events">
                    <div class="empty-events-icon">📆</div>
                    <h3 class="empty-events-title">Vue calendrier à venir</h3>
                    <p class="empty-events-description">
                        La vue calendrier sera bientôt disponible pour visualiser tous les événements du mois.
                    </p>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    // Filtrage des événements
    document.querySelectorAll('.filter-event-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.filter-event-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const filter = btn.dataset.filter;
            document.querySelectorAll('.event-card').forEach(card => {
                if (filter === 'all') {
                    card.style.display = '';
                } else if (filter === 'inscrit') {
                    card.style.display = card.dataset.inscrit === 'true' ? '' : 'none';
                } else if (filter === 'upcoming') {
                    card.style.display = card.dataset.status === 'upcoming' ? '' : 'none';
                } else {
                    card.style.display = card.dataset.type === filter ? '' : 'none';
                }
            });
        });
    });

    // Vue grille / calendrier
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const view = btn.dataset.view;
            document.getElementById('eventsGrid').style.display = view === 'grid' ? 'grid' : 'none';
            document.getElementById('calendarView').classList.toggle('active', view === 'calendar');
        });
    });

    // Action inscription
    window.inscrireEvenement = function(eventId) {
        // À compléter : requête AJAX pour inscrire l'utilisateur à l'événement
        alert("Inscription à l'événement " + eventId + " (fonction à compléter)");
    };

    // Action voir détails
    window.voirEvenement = function(eventId) {
        // À compléter : ouvrir une modale ou rediriger vers la page de détails
        alert("Voir détails de l'événement " + eventId + " (fonction à compléter)");
    };
</script>
